<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Run an Indepdent Chain - Conflux Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Run an Indepdent Chain";
    var mkdocs_page_input_path = "setup_independent_chain.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Conflux Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Welcome to Conflux</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../install/">Installation</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../get_started/">Getting Started</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">Run an Indepdent Chain</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#how-to-set-an-independent-conflux-chain">How to Set an Independent Conflux Chain</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#run-single-node-development-chain">Run Single Node Development Chain</a></li>
        
            <li><a class="toctree-l3" href="#run-multiple-node-production-chain">Run Multiple Node Production Chain</a></li>
        
            <li><a class="toctree-l3" href="#a-simple-instruction">A Simple Instruction</a></li>
        
        </ul>
    

    <li class="toctree-l2"><a href="#put-conflux-executable-conflux-and-the-configuration-file-bootnodetoml-under-run">Put Conflux executable conflux and the configuration file bootnode.toml under run</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#setting-multiple-bootnodes">Setting Multiple Bootnodes</a></li>
        
            <li><a class="toctree-l3" href="#setting-genesis-accounts">Setting Genesis Accounts</a></li>
        
        </ul>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../json-rpc/">JSON-RPC API</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../javascript-api/">JavaScript API</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../cli/">CLI Sub-commands</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../design/">Design & Implementation</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../send_transaction/">My First Transaction</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Conflux Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Run an Indepdent Chain</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="how-to-set-an-independent-conflux-chain">How to Set an Independent Conflux Chain<a class="headerlink" href="#how-to-set-an-independent-conflux-chain" title="Permanent link">&para;</a></h1>
<p>You may want to run Conflux on a single node chain to develop and test smart
contracts. You can run Conflux as your indepdent chain with several machines.</p>
<h2 id="run-single-node-development-chain">Run Single Node Development Chain<a class="headerlink" href="#run-single-node-development-chain" title="Permanent link">&para;</a></h2>
<p>In order to run a single node Conflux chain for development, you can follow the
following steps:</p>
<ol>
<li>
<p>Get executable Conflux binary file (use precompiled binary or build from the
latest source code). You can refer to the document
<a href="https://conflux-chain.github.io/conflux-doc/install/">Installation</a>.</p>
</li>
<li>
<p>Create a directory and prepare a configuration file <code>development.toml</code>. You
can copy the <code>default.toml</code> provided in the directory and start from there
following the guide <a href="https://conflux-chain.github.io/conflux-doc/get_started/">Getting
Started</a>. </p>
</li>
<li>
<p>Set the <code>bootnodes</code> parameter in the configuration file to empty (or comment
the setting line).</p>
</li>
<li>
<p>Set the <code>mode</code> parameter to "dev". If you copy from <code>default.toml</code>, you
should find the line being commented and you can uncomment it.</p>
</li>
<li>
<p>Set the <code>dev_block_interval_ms</code> parameter to the block generation interval
you want. In the development mode, Conflux will automatically generate a block
in a fixed interval.</p>
</li>
<li>
<p>Run Conflux binary with <code>development.toml</code> as the configuration file. For
example:</p>
<p><code>bash
$ ../target/release/conflux --config development.toml</code> </p>
</li>
</ol>
<h2 id="run-multiple-node-production-chain">Run Multiple Node Production Chain<a class="headerlink" href="#run-multiple-node-production-chain" title="Permanent link">&para;</a></h2>
<p>To have your independent Conflux chain with multiple nodes in the production
mode, you need to ensure that your nodes can be connected to other nodes in
this chain, and will not connect to other chains (like our testnet).</p>
<p>To achieve this, you should setup your own boot node, and let other nodes
connect to it. Then they will connect to others with our discovery protocol.</p>
<p>You need the IP address, the port number, and the node id of the bootnode for
others to connect. The node id is the public key corresponding the the node's
unique private key for identification at the network layer. And here is an
instruction to let the bootnode generate its private key automatically, and get
the node id through the log file.</p>
<h2 id="a-simple-instruction">A Simple Instruction<a class="headerlink" href="#a-simple-instruction" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>Get executable Conflux binary file (use precompiled binary or build from the
latest source code). You can refer to the document
<a href="https://conflux-chain.github.io/conflux-doc/install/">Installation</a>.</p>
</li>
<li>
<p>Create a directory and prepare a configuration file <code>bootnode.toml</code> for the
bootnode (the default port is 32323 if not set). You can refer to <a href="https://conflux-chain.github.io/conflux-doc/get_started/">Getting
Started</a>.</p>
<p>Ensure that <code>bootnode.toml</code> does not contain the <code>bootnode</code> entry, and the
log level for <code>network</code> is at least <code>debug</code>. </p>
<p>```bash
$ mkdir run
$ cd run</p>
<h1 id="put-conflux-executable-conflux-and-the-configuration-file-bootnodetoml-under-run">Put Conflux executable <code>conflux</code> and the configuration file <code>bootnode.toml</code> under <code>run</code><a class="headerlink" href="#put-conflux-executable-conflux-and-the-configuration-file-bootnodetoml-under-run" title="Permanent link">&para;</a></h1>
<p>```</p>
<p>If you are editing based on our provided <code>default.toml</code>, you need to
comment out the <code>bootnode</code> entry. Otherwise the node will connect to the
existing Conflux net. </p>
</li>
<li>
<p>Launch the bootnode, and find the node id in the console print out. The
information for node id is <code>Self node id: $ID</code> where <code>$ID</code> is the 0x-prefixed
node id of this bootnode. Remove the 0x prefix and you'll get the node id
<code>$NODEID</code>. If you missed the line from the screen, you can look at the log file
with:</p>
<p><code>bash
grep "Self node id" log/conflux.log|awk '{print $9}'|tr -d '0x'</code></p>
</li>
<li>
<p>Now we have the <code>$IP</code>, <code>$PORT$</code>, and <code>$NODEID</code> of the boot node, we can get
the url for this boot node with the format <code>cfxnode://$NODEID@$IP:$PORT</code>.
Denote this as <code>$BOOTNODE_URL</code>.</p>
</li>
<li>
<p>Start other nodes by setting <code>bootnodes="$BOOTNODE_URL"</code> in their
configuration.</p>
</li>
</ol>
<p>Note that with the instruction above, other nodes connected to the boot node
will stay in untrusted state for a while (3 days by default), and untrusted
nodes will not be broadcast in our discovery protocol. Thus, the network
structure will be a star with the boot node in the center before other nodes
are promoted to trusted state. You can change <code>node_table_promotion_timeout_s</code>
in the configurations to make this period shorter.</p>
<h2 id="setting-multiple-bootnodes">Setting Multiple Bootnodes<a class="headerlink" href="#setting-multiple-bootnodes" title="Permanent link">&para;</a></h2>
<p>You can also setup multiple bootnodes at the very beginning. However, this
cannot be done by simply replaying the boot node setup steps above multiple
times, because you need to set <code>bootnodes</code> of every boot node before they are
started.</p>
<p>One way to achieve this is to start these bootnodes and stop them immediately.
Then gather their node ids, set their configuration, and restart them all.</p>
<p>Another better way is to generate their private keys seperately, and manually
set their <code>net_key</code> to start. This can be done with the functions provided in
our python test framework in the directory <code>test</code>.</p>
<pre><code class="python">from conflux.utils import *

num_of_bootnodes=10
for _ in range(num_of_bootnodes):
    pri_key, pub_key = ec_random_keys()
    node_id = encode_hex(encode_int32(pub_key[0]) + encode_int32(pub_key[1]))
    print(encode_hex(pri_key), node_id)
</code></pre>

<p>Then you can construct the bootnode url with the generated node id, and start
each node by setting the <code>net_key="$NET_KEY"</code> field to the private key or pass
it with the command line option <code>--net-key $NET_KEY</code>.</p>
<h2 id="setting-genesis-accounts">Setting Genesis Accounts<a class="headerlink" href="#setting-genesis-accounts" title="Permanent link">&para;</a></h2>
<p>In a production environment, you can initialize the initial genesis state with
your accounts by setting the <code>genesis_accounts</code> to an account file with formats
like</p>
<pre><code>0f947e34fc907008968ec99baa1dbb677b927531=&quot;1000000000000&quot;
ab4a32bca7500d94a2cc1f3150e12686c692c590=&quot;1000000000000&quot;
</code></pre>

<p>Every line is an account. The key is the account address, and the value is a
string representing its balance in Drip. Note that <code>genesis_accounts</code> does not
apply if <code>mode</code> is <code>test</code> or <code>dev</code>.</p>
<p>If the <code>mode</code> is <code>test</code> or <code>dev,</code> you can setup the genesis accounts with their
secret keys by setting <code>genesis_secrets</code>. Each line is an account private key
without 0x-prefix. The balance of each account is set to
<code>10000000000000000000000</code> by default.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../json-rpc/" class="btn btn-neutral float-right" title="JSON-RPC API">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../get_started/" class="btn btn-neutral" title="Getting Started"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright © 2019 Conflux. All Rights Reserved.</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../get_started/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../json-rpc/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
